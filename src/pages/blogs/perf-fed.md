---
title: 前端性能优化思路
date: 2022-06-10
tags: 前端
meta:
  - name: description
    content: IO CPU
---

如何对 APP 内的 H5 页面做性能优化？你有哪些不同的思考角度？

什么是性能？性能的本质是用户体验。用户感觉不到卡顿，就说明页面性能上没问题。

卡顿是什么？用户的每一项操作之后，都在等待 app 做出响应或者说反馈，等待的时间超过一定标准，就是卡顿。

比如说用户打开一个页面，开始等待页面加载完成；用户在一个文本框内输入文字，等待文字出现在框中；用户滑动页面，往下想查看其他内容，等待页面向上移动；用户点击按钮提交，等待服务器返回结果。

可以看出，不同场景下，等待时间的标准是不一样的。这主要是人的心理预期导致的。人们习惯于页面加载这个过程，所以相对宽容一些，可以等个 1 到 2 秒。而对于输入文字以及滑动页面这种操作，则等个几十毫秒都觉得卡死了。

那么造成卡顿的原因主要是什么？IO 和 CPU。

页面加载速度，主要受限于网络，网络就是 IO 的一种（可以说网页的 IO 主要就是网络）。这个该怎么优化呢？两方面，开源节流嘛。一是提高网速，二是减少资源文件的传输量。

提高网速怎么办呢？手机端网络一般都是 4G 或者 wifi，带宽这块儿其实没什么可以提升的，作为开发者无能为力。但是我们细想，网速是啥决定的，除了带宽那就是距离（粗略理解为经过多少个路由器），所以我们就想到了 CDN，通过把静态资源部署在 CDN 节点，就可以让用户在最近的服务器上下载资源，变相地提升了访问速度。

减少资源文件的传输量，其实有两层含义，一是减小资源文件的大小，这就要求我们合理组织代码并运用打包工具，删除无用的代码（tree-shaking），压缩代码（所以用更短的变量是没什么用的），按需加载（可以比较明显提升首屏的加载速度）。二是减少资源的传输次数，其实也就是合理运用缓存，这块儿挺复杂的（各种缓存策略的运用），就不展开说了。

有时候，我们输入文字或者滑动页面会非常卡，这是为什么呢，答案是 CPU 不够用了。JS 是单线程的，这个大家应该都知道，渲染和 JS 的执行在一个线程上，这是劣势（无法并行），也是优势（简化模型，方便开发）。多线程这块儿唯一的例外就是 webworker 了，但是它不能操作 DOM，但是如果你有繁重的计算任务（比如科学计算、机器学习），就可以利用上它。抛开 worker 不说，我们就认为只有一个线程可以用。怎么用？省着点用呗！尤其是用户触发的一些事件，click、input、scroll 这些事件处理逻辑一定要保持尽可能的轻量，能异步就异步，繁重的计算可以 CPU 分片。

占用 CPU 的不光是 JS，还有浏览器的渲染或者说排版引擎，那么怎么减轻这部分工作呢？

一方面就是动画，合理的动画运用，可以直观地减少用户的“心理等待时间”。动画一定不要太多，通篇动画看起来很炫酷，但是会给用户带来困扰，是一种极差的实践；动画一定要贴合场景，时长不宜过短也不宜过长，一些过场动画一定要脆，让用户觉得爽。、干脆利落。另外，动画的卡顿属于老生常谈了，尽量使用 transformopacity 不要用 marginpaddingleft 之类的属性。

再就是页面的布局，合理安排布局，不要生成过多的 layer 或者过多的元素，也是性能很重要的一部分。比如长列表，就可以使用“虚拟化技术”，只渲染可见部分，这块儿展开讲也是很复杂，按下不表，网上也有很多这方面的文章。

上面所说就是通用的 web 页面优化方向。题目所说的 APP 中的页面，其实本质上也都是一样的。不过 APP 的优势就是，可以不用从网络而从本地获取资源，这样变相提升了“带宽”（好快！尤其手机都是闪存芯片），所以我们可以把一些很少变化的关键的资源尤其首屏的一些资源，打包在 app 内。这本质也是 IO 方面的优化啦。

完。
